<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Prediction System for Gold & BTC</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            max-width: 900px;
            margin: 0 20px;
            display: flex;
        }
        .sidebar {
            width: 300px;
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
        }
        .content {
            flex-grow: 1;
            margin-left: 20px;
        }
        h1, h3 {
            text-align: center;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
        }
        .btn {
            background-color: #007bff;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
            width: 100%;
            text-align: center;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .price-display, .clock-display, .prediction-result {
            margin-top: 20px;
            font-size: 1.5rem;
            text-align: center;
        }
        .loading {
            font-size: 1.2rem;
            color: grey;
        }
        .green-text {
            color: green;
            font-weight: bold;
        }
        .red-text {
            color: red;
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="content">
            <h1>Gold & Bitcoin Candle Prediction</h1>

            <!-- MetaApi Connection Status -->
            <div id="connection-status" class="status disconnected">Not connected to MetaApi</div>

            <!-- Asset Selection -->
            <div class="form-group">
                <label for="asset-pair">Select Asset</label>
                <select id="asset-pair">
                    <option value="XAUUSD">Gold (XAU/USD)</option>
                    <option value="BTCUSD">Bitcoin (BTC/USD)</option>
                </select>
            </div>

            <!-- Time Frame Selection -->
            <div class="form-group">
                <label for="time-frame">Select Time Frame</label>
                <select id="time-frame">
                    <option value="15m">15 Minutes</option>
                    <option value="30m">30 Minutes</option>
                    <option value="1h">1 Hour</option>
                    <option value="4h">4 Hours</option>
                </select>
            </div>

            <!-- Predict Button -->
            <div class="form-group">
                <button class="btn" onclick="predictAndShowPrice()">Predict & Show Live Price</button>
            </div>

            <!-- Live Market Price -->
            <div id="live-price" class="price-display">Live Price: <span id="price-value">Loading...</span></div>
            <div id="loading-indicator" class="loading"></div>

            <!-- Prediction Result -->
            <div id="patterns" class="prediction-result"></div>

            <!-- Prediction Table -->
            <h3>Prediction History</h3>
            <table id="prediction-history-table">
                <thead>
                    <tr>
                        <th>Asset</th>
                        <th>Time Frame</th>
                        <th>Prediction</th>
                        <th>Live Price</th>
                        <th>Result</th>
                    </tr>
                </thead>
                <tbody id="prediction-table">
                    <!-- Prediction history will be populated here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Load MetaApi SDK -->
    <script src="https://cdn.jsdelivr.net/npm/metaapi.cloud-sdk@7.3.2/lib/metaapi.min.js"></script>

    <script>
        // MetaApi token and account setup
        const api = new MetaApi('YOUR_METAAPI_TOKEN'); // Replace with your MetaApi token
        const accountId = 'YOUR_ACCOUNT_ID'; // Replace with your MetaApi account ID

        // Indicator for connection status
        let isConnected = false;

        // Function to fetch price and show connection status
        async function fetchRealTimePrice(symbol) {
            try {
                const connectionStatus = document.getElementById('connection-status');
                const loadingIndicator = document.getElementById('loading-indicator');

                connectionStatus.className = 'status loading';
                connectionStatus.innerHTML = "Connecting to MetaApi...";
                loadingIndicator.innerHTML = "Fetching live price...";

                const account = await api.metatraderAccountApi.getAccount(accountId);

                if (!account.connected) {
                    await account.connect();
                    console.log('Connected to MetaApi account.');
                    isConnected = true;
                    connectionStatus.className = 'status connected';
                    connectionStatus.innerHTML = "Connected to MetaApi";
                }

                const priceData = await account.getSymbolPrice(symbol);
                const price = priceData.bid;  // Use the bid price for the current price
                loadingIndicator.innerHTML = ""; // Clear loading indicator
                return price;

            } catch (error) {
                console.error('Error fetching price:', error);
                const connectionStatus = document.getElementById('connection-status');
                connectionStatus.className = 'status disconnected';
                connectionStatus.innerHTML = "Failed to connect to MetaApi";
                document.getElementById('loading-indicator').innerHTML = "Error fetching price.";
                return 'Error';
            }
        }

        // Function to get time frame in milliseconds
        function getTimeFrameMillis(timeFrame) {
            switch (timeFrame) {
                case '15m': return 900000; // 15 minutes
                case '30m': return 1800000; // 30 minutes
                case '1h': return 3600000; // 1 hour
                case '4h': return 14400000; // 4 hours
                default: return 900000; // Default to 15 minutes
            }
        }

        // Main function to fetch price and make prediction
        async function predictAndShowPrice() {
            const assetPair = document.getElementById("asset-pair").value;
            const timeFrame = document.getElementById("time-frame").value;

            // Fetch and show the live price
            const currentPrice = await fetchRealTimePrice(assetPair);
            document.getElementById('price-value').innerHTML = currentPrice;

            // Create a simple prediction message
            const prediction = Math.random() > 0.5 ? 'Up' : 'Down';
            const nextCandle = `The next candle will go ${prediction} for ${assetPair} on ${timeFrame} timeframe.`;
            document.getElementById('patterns').innerHTML = nextCandle;

            // Update prediction history table
            const predictionTableBody = document.getElementById('prediction-table');
            const row = `<tr>
                <td>${assetPair}</td>
                <td>${timeFrame}</td>
                <td>${prediction}</td>
                <td>${currentPrice}</td>
                <td>Pending</td>
            </tr>`;
            predictionTableBody.innerHTML = row + predictionTableBody.innerHTML; // Insert latest prediction at the top
        }
    </script>
</body>
</html>
