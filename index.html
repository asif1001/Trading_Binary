<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Gold & BTC Prediction with TP/SL and Patterns</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            max-width: 900px;
            margin: 0 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
        }
        .btn {
            background-color: #007bff;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
            width: 100%;
            text-align: center;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .price-display, .clock-display, .prediction-result {
            margin-top: 20px;
            font-size: 1.5rem;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        #tradingview_widget {
            height: 400px;
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Gold & Bitcoin Prediction with TP/SL</h1>

        <!-- Asset Selection -->
        <div class="form-group">
            <label for="asset-pair">Select Asset</label>
            <select id="asset-pair" onchange="loadTradingViewChart()">
                <option value="XAUUSD">Gold (XAU/USD)</option>
                <option value="BTCUSD">Bitcoin (BTC/USD)</option>
            </select>
        </div>

        <!-- Time Frame Selection -->
        <div class="form-group">
            <label for="time-frame">Select Time Frame</label>
            <select id="time-frame">
                <option value="15m">15 Minutes</option>
                <option value="30m">30 Minutes</option>
                <option value="1h">1 Hour</option>
                <option value="4h">4 Hours</option>
            </select>
        </div>

        <!-- TradingView Widget for Live Chart -->
        <div id="tradingview_widget"></div>

        <!-- Predict Button -->
        <div class="form-group">
            <button class="btn" onclick="predictAndShowPrice()">Predict & Show TP/SL</button>
        </div>

        <!-- Prediction Result with TP and SL -->
        <div id="patterns" class="prediction-result"></div>

        <!-- Candlestick Patterns -->
        <h3>Detected Candlestick Patterns</h3>
        <table id="candlestick-patterns-table">
            <thead>
                <tr>
                    <th>Asset</th>
                    <th>Pattern</th>
                    <th>Time Frame</th>
                    <th>Suggested Action</th>
                </tr>
            </thead>
            <tbody id="pattern-list">
                <!-- Detected patterns will be shown here -->
            </tbody>
        </table>

        <!-- Prediction Table -->
        <h3>Prediction History</h3>
        <table id="prediction-history-table">
            <thead>
                <tr>
                    <th>Asset</th>
                    <th>Time Frame</th>
                    <th>Prediction</th>
                    <th>Entry Price</th>
                    <th>TP</th>
                    <th>SL</th>
                    <th>Result</th>
                </tr>
            </thead>
            <tbody id="prediction-table">
                <!-- Prediction history will be populated here -->
            </tbody>
        </table>
    </div>

    <!-- TradingView Widget Script -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

    <!-- Custom Script -->
    <script>
        // Function to load TradingView widget based on selected asset
        function loadTradingViewChart() {
            const asset = document.getElementById("asset-pair").value;

            // Remove existing widget (if any)
            const widgetContainer = document.getElementById("tradingview_widget");
            widgetContainer.innerHTML = '';

            // Create TradingView widget
            new TradingView.widget({
                "width": "100%",
                "height": 400,
                "symbol": asset,
                "interval": "15",
                "timezone": "Etc/UTC",
                "theme": "light",
                "style": "1",
                "locale": "en",
                "toolbar_bg": "#f1f3f6",
                "enable_publishing": false,
                "withdateranges": true,
                "hide_side_toolbar": false,
                "allow_symbol_change": true,
                "details": true,
                "container_id": "tradingview_widget"
            });
        }

        // Load default chart on page load
        window.onload = function() {
            loadTradingViewChart();
        };

        // Function to calculate TP and SL (dummy logic for now)
        function calculateTPandSL(currentPrice, asset) {
            let tp, sl;
            if (asset === 'XAUUSD') { // For Gold
                tp = currentPrice + 10; // Example: Add $10 for TP
                sl = currentPrice - 10; // Example: Subtract $10 for SL
            } else if (asset === 'BTCUSD') { // For Bitcoin
                tp = currentPrice + 100; // Example: Add $100 for TP
                sl = currentPrice - 100; // Example: Subtract $100 for SL
            }
            return { tp, sl };
        }

        // Function to detect candlestick patterns (dummy logic for now)
        function detectCandlestickPatterns(asset) {
            const patterns = {
                "XAUUSD": { pattern: "Bullish Engulfing", timeFrame: "1h", action: "Buy" },
                "BTCUSD": { pattern: "Doji", timeFrame: "4h", action: "Wait" }
            };
            return patterns[asset] || null;
        }

        // Main function to predict and show TP/SL
        function predictAndShowPrice() {
            const assetPair = document.getElementById("asset-pair").value;
            const timeFrame = document.getElementById("time-frame").value;
            const currentPrice = 1000;  // Mock current price, update with real price if available

            // Calculate TP and SL
            const { tp, sl } = calculateTPandSL(currentPrice, assetPair);

            // Create a simple prediction message
            const prediction = Math.random() > 0.5 ? 'Up' : 'Down';
            const nextCandle = `Prediction: The next candle will go ${prediction}. <br> TP: ${tp}, SL: ${sl}`;
            document.getElementById('patterns').innerHTML = nextCandle;

            // Detect candlestick pattern (mock detection for demo purposes)
            const detectedPattern = detectCandlestickPatterns(assetPair);
            const patternTableBody = document.getElementById('pattern-list');
            if (detectedPattern) {
                const row = `<tr>
                    <td>${assetPair}</td>
                    <td>${detectedPattern.pattern}</td>
                    <td>${detectedPattern.timeFrame}</td>
                    <td>${detectedPattern.action}</td>
                </tr>`;
                patternTableBody.innerHTML = row; // Replace with latest detected pattern
            }

            // Update prediction history table
            const predictionTableBody = document.getElementById('prediction-table');
            const row = `<tr>
                <td>${assetPair}</td>
                <td>${timeFrame}</td>
                <td>${prediction}</td>
                <td>${currentPrice}</td>
                <td>${tp}</td>
                <td>${sl}</td>
                <td>Pending</td>
            </tr>`;
            predictionTableBody.innerHTML = row + predictionTableBody.innerHTML; // Insert latest prediction at the top
        }
    </script>
</body>
</html>
