<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Gold & BTC Prediction with TP/SL and Patterns</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            max-width: 900px;
            margin: 0 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
        }
        .btn {
            background-color: #007bff;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
            width: 100%;
            text-align: center;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .price-display, .clock-display, .prediction-result {
            margin-top: 20px;
            font-size: 1.5rem;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Gold & Bitcoin Prediction with TP/SL</h1>

        <!-- Asset Selection -->
        <div class="form-group">
            <label for="asset-pair">Select Asset</label>
            <select id="asset-pair">
                <option value="XAU/USD">Gold (XAU/USD)</option>
                <option value="BTC/USD">Bitcoin (BTC/USD)</option>
            </select>
        </div>

        <!-- Time Frame Selection -->
        <div class="form-group">
            <label for="time-frame">Select Time Frame</label>
            <select id="time-frame">
                <option value="15m">15 Minutes</option>
                <option value="30m">30 Minutes</option>
                <option value="1h">1 Hour</option>
                <option value="4h">4 Hours</option>
            </select>
        </div>

        <!-- Predict Button -->
        <div class="form-group">
            <button class="btn" onclick="predictAndShowPrice()">Predict & Show TP/SL</button>
        </div>

        <!-- Live Market Price -->
        <div id="live-price" class="price-display">Live Price: <span id="price-value">Loading...</span></div>
        <div id="loading-indicator" class="loading"></div>

        <!-- Prediction Result with TP and SL -->
        <div id="patterns" class="prediction-result"></div>

        <!-- Candlestick Patterns -->
        <h3>Detected Candlestick Patterns</h3>
        <table id="candlestick-patterns-table">
            <thead>
                <tr>
                    <th>Asset</th>
                    <th>Pattern</th>
                    <th>Time Frame</th>
                    <th>Suggested Action</th>
                </tr>
            </thead>
            <tbody id="pattern-list">
                <!-- Detected patterns will be shown here -->
            </tbody>
        </table>

        <!-- Prediction Table -->
        <h3>Prediction History</h3>
        <table id="prediction-history-table">
            <thead>
                <tr>
                    <th>Asset</th>
                    <th>Time Frame</th>
                    <th>Prediction</th>
                    <th>Entry Price</th>
                    <th>TP</th>
                    <th>SL</th>
                    <th>Result</th>
                </tr>
            </thead>
            <tbody id="prediction-table">
                <!-- Prediction history will be populated here -->
            </tbody>
        </table>
    </div>

    <!-- Custom Script -->
    <script>
        const apiKey = '6ecda4d1ff2c4f0b91b7ddf7d7140721'; // Your Twelve Data API key
        const twelveDataUrl = 'https://api.twelvedata.com/price';

        // Function to fetch live price from Twelve Data
        async function fetchRealTimePrice(symbol) {
            try {
                document.getElementById('loading-indicator').innerHTML = "Fetching live price...";
                const response = await fetch(`${twelveDataUrl}?symbol=${symbol}&apikey=${apiKey}`);
                const data = await response.json();
                document.getElementById('loading-indicator').innerHTML = ""; // Clear loading indicator
                return parseFloat(data.price).toFixed(2); // Return price with 2 decimal places
            } catch (error) {
                console.error('Error fetching price:', error);
                document.getElementById('loading-indicator').innerHTML = "Error fetching price.";
                return 'Error';
            }
        }

        // Function to calculate TP and SL
        function calculateTPandSL(currentPrice, asset) {
            let tp, sl;
            if (asset === 'XAU/USD') { // For Gold
                tp = currentPrice + 10; // Example: Add $10 for TP
                sl = currentPrice - 10; // Example: Subtract $10 for SL
            } else if (asset === 'BTC/USD') { // For Bitcoin
                tp = currentPrice + 100; // Example: Add $100 for TP
                sl = currentPrice - 100; // Example: Subtract $100 for SL
            }
            return { tp, sl };
        }

        // Function to detect candlestick patterns (dummy logic for now)
        function detectCandlestickPatterns(asset) {
            const patterns = {
                "XAU/USD": { pattern: "Bullish Engulfing", timeFrame: "1h", action: "Buy" },
                "BTC/USD": { pattern: "Doji", timeFrame: "4h", action: "Wait" }
            };
            return patterns[asset] || null;
        }

        // Main function to fetch price, predict and show TP/SL
        async function predictAndShowPrice() {
            const assetPair = document.getElementById("asset-pair").value;
            const timeFrame = document.getElementById("time-frame").value;

            // Fetch and show the live price
            const currentPrice = await fetchRealTimePrice(assetPair);
            document.getElementById('price-value').innerHTML = currentPrice;

            // Calculate TP and SL
            const { tp, sl } = calculateTPandSL(currentPrice, assetPair);

            // Create a simple prediction message
            const prediction = Math.random() > 0.5 ? 'Up' : 'Down';
            const nextCandle = `Prediction: The next candle will go ${prediction}. <br> TP: ${tp}, SL: ${sl}`;
            document.getElementById('patterns').innerHTML = nextCandle;

            // Detect candlestick pattern (mock detection for demo purposes)
            const detectedPattern = detectCandlestickPatterns(assetPair);
            const patternTableBody = document.getElementById('pattern-list');
            if (detectedPattern) {
                const row = `<tr>
                    <td>${assetPair}</td>
                    <td>${detectedPattern.pattern}</td>
                    <td>${detectedPattern.timeFrame}</td>
                    <td>${detectedPattern.action}</td>
                </tr>`;
                patternTableBody.innerHTML = row; // Replace with latest detected pattern
            }

            // Update prediction history table
            const predictionTableBody = document.getElementById('prediction-table');
            const row = `<tr>
                <td>${assetPair}</td>
                <td>${timeFrame}</td>
                <td>${prediction}</td>
                <td>${currentPrice}</td>
                <td>${tp}</td>
                <td>${sl}</td>
                <td>Pending</td>
            </tr>`;
            predictionTableBody.innerHTML = row + predictionTableBody.innerHTML; // Insert latest prediction at the top
        }
    </script>
</body>
</html>
